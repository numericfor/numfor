<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NuMFor: Submodule integrate</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="highlight.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">NuMFor
   &#160;<span id="projectnumber">ab0bca2 (2019-12-20)</span>
   </div>
   <div id="projectbrief">Numerical (Modern) Fortran. Library for Simple Numerical computing</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('a00952.html','');});
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Submodule integrate </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>There are implemented several routines for integration of functions, and also sampled values via Trapezoid and Simpson methods.</p>
<p>Each algorithm computes an approximation to a definite integral of the form,</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[J \approx I := \int_a^b f(x) w(x) dx\]" src="form_1.png"/>
</p>
<p>where <img class="formulaInl" alt="$w(x)$" src="form_2.png"/> is a weight function, which may be <img class="formulaInl" alt="$w(x) = 1$" src="form_3.png"/>.</p>
<h2><a class="anchor" id="integwhichfunction"></a>Integrable functions</h2>
<p>All routines described here may integrate functions that return either <b>real</b> or <b>complex</b> values. They may have one of the following signatures:</p>
<ul>
<li>real function <code>f(x)</code> of a real argument <code>x</code></li>
<li>complex function <code>f(x)</code> of a real argument <code>x</code></li>
<li>real function <code>f(x,args)</code> of real arguments <code>x</code>, and array <code>args</code></li>
<li>complex function <code>f(x,args)</code> of real arguments <code>x</code>, and array <code>args</code></li>
</ul>
<p>For functions that need extra arguments besides the integration variable <code>x</code>, the argument array must be passed to the integration routines.</p>
<p>There is also the possibility of using</p><ul>
<li><a class="el" href="a00452.html#a00517">type(nf_rfunction)</a> for real functions or</li>
<li><a class="el" href="a00452.html#a00521">type(nf_cfunction)</a> for complex functions</li>
</ul>
<h2><a class="anchor" id="desctrapezoid"></a>Trapezoid and Simpson rules</h2>
<p>There are implemented routines for integration of functions by simple <a class="el" href="a00455.html">Trapezoid and Simpson</a> rules via two routines <a class="el" href="a00545.html">trapz</a> and <a class="el" href="a00553.html">simps</a>. The use of both routines is very similar. For instance:</p>
<p>If we have data sampled to a grid of <b>ordered</b> values, we can integrate them by using trapezoid or simpson quadrature similarly as with functions. In order to use them we have only to call <a class="el" href="a00545.html">trapz</a> or <a class="el" href="a00553.html">simps</a></p>
<div class="fragment"><div class="line"><span class="keyword">program</span> ex_trapz</div><div class="line">  <span class="keywordtype">USE </span>numfor, <span class="keywordtype">only</span>: dp, zero, m_pi, str, trapz, linspace</div><div class="line">  <span class="keywordtype">implicit none</span></div><div class="line"></div><div class="line"><span class="keywordtype">  real</span>(dp), <span class="keywordtype">dimension(20)</span> :: x</div><div class="line"><span class="keywordtype">  real</span>(dp), <span class="keywordtype">dimension(20)</span> :: y</div><div class="line">  </div><div class="line"><span class="keywordtype">  real</span>(dp) :: Integ1</div><div class="line">  <span class="keywordtype">intrinsic</span> dsin</div><div class="line"></div><div class="line">  integ1 = trapz(dsin, zero, m_pi)</div><div class="line">  print <span class="stringliteral">&quot;(A)&quot;</span>, <span class="stringliteral">&#39;\int \sin(x) dx = &#39;</span>//str(integ1)//<span class="stringliteral">&quot; (Difference=&quot;</span>//str(abs(2 - integ1))//<span class="stringliteral">&quot;)&quot;</span></div><div class="line">  <span class="comment">! \int \sin(x) dx = 1.999832163894 (Difference=0.000167836106)</span></div><div class="line">  </div><div class="line">  <span class="comment">!  Integration of sampled data</span></div><div class="line">  x = linspace(zero, m_pi, 20)</div><div class="line">  y = dsin(x)</div><div class="line">  integ1 = trapz(y, zero, m_pi)</div><div class="line">  print <span class="stringliteral">&quot;(A)&quot;</span>, <span class="stringliteral">&#39;\int \sin(x) dx = &#39;</span>//str(integ1)//<span class="stringliteral">&quot; (Difference=&quot;</span>//str(abs(2 - integ1))//<span class="stringliteral">&quot;)&quot;</span></div><div class="line">  <span class="comment">! \int \sin(x) dx = 1.9980436909706 (Difference=0.0019563090294)</span></div><div class="line"></div><div class="line">  <span class="comment">! Integration of a function</span></div><div class="line">  integ1 = trapz(dsin, zero, m_pi, n=<span class="keyword">size</span>(y))</div><div class="line">  print <span class="stringliteral">&quot;(A)&quot;</span>, <span class="stringliteral">&#39;\int \sin(x) dx = &#39;</span>//str(integ1)//<span class="stringliteral">&quot; (Difference=&quot;</span>//str(abs(2 - integ1))//<span class="stringliteral">&quot;)&quot;</span></div><div class="line">  <span class="comment">! \int \sin(x) dx = 1.9980436909706 (Difference=0.0019563090294)</span></div><div class="line"></div><div class="line"><span class="keyword">end program </span>ex_trapz</div><div class="line"></div></div><!-- fragment --><p>The use of Simpson routine is similar, and need only to replace <code>trapz()</code> by <code>simps()</code></p>
<h2><a class="anchor" id="desciadsimps"></a>Adaptive Simpson method</h2>
<p>In addition to The simple, fixed points, Simpson quadrature routines there are implemented Globally Adaptive Simpson routines for <a class="el" href="a00537.html">finite</a> and <a class="el" href="a00537.html">infinite</a> integration domains.</p>
<p>Routine <a class="el" href="a00537.html">iads</a> follows a scheme in which the integration interval is bisected, and the Simpson integration result for the sum of the subintervals is compared with the result for the parent interval. For each subdivision, only three additional function evaluations are needed. This routine is regarded as a good choice when moderate precision ( <img class="formulaInl" alt="$10^{-3}, 10^{-4}$" src="form_4.png"/>) is required.</p>
<div class="fragment"><div class="line"><span class="keyword">program</span> ex_iads</div><div class="line">  <span class="keywordtype">USE </span>numfor, <span class="keywordtype">only</span>: dp, zero, m_pi, str, iads</div><div class="line">  <span class="keywordtype">implicit none</span></div><div class="line"></div><div class="line"><span class="keywordtype">  real</span>(dp) :: err</div><div class="line">  <span class="keywordtype">integer</span> :: N</div><div class="line"></div><div class="line">  </div><div class="line"><span class="keywordtype">  real</span>(dp) :: Integ1</div><div class="line">  <span class="keywordtype">intrinsic</span> dsin</div><div class="line"></div><div class="line">  <span class="keyword">call </span>iads(dsin, zero, m_pi, integ1)</div><div class="line">  print <span class="stringliteral">&quot;(A)&quot;</span>, <span class="stringliteral">&#39;integrate(sin(x), 0, pi) = &#39;</span>//str(integ1)//<span class="stringliteral">&quot; (Difference=&quot;</span>//str(abs(2 - integ1))//<span class="stringliteral">&quot;)&quot;</span></div><div class="line">  <span class="comment">! integrate(sin(x), 0, pi) = 1.9999998386284 (Difference=1.6137164227104e-07)</span></div><div class="line">  <span class="comment">! &lt; [Simple]</span></div><div class="line">  <span class="keyword">call </span>iads(fquad451, 1.e-12_dp, m_pi, integ1, epsrel=1.e-7_dp, abserr=err, neval=n)</div><div class="line">  print <span class="stringliteral">&quot;(A)&quot;</span>, <span class="stringliteral">&#39;integrate( \log(x) \sqrt(x), 1.e-12, pi) = &#39;</span>//str(integ1)//<span class="stringliteral">&quot; (Error=&quot;</span>//str(err)//<span class="stringliteral">&quot;) with N = &quot;</span>//str(abs(n))</div><div class="line">  <span class="comment">! integrate( \log(x) \sqrt(x), 1.e-12, pi) = 1.7746775593141 (Error=1.3697319985965e-05) with N = 89</span></div><div class="line"></div><div class="line"><span class="keyword">contains</span></div><div class="line">  <span class="keyword">function </span>fquad451(x) <span class="keyword">result</span>(y)</div><div class="line">    <span class="keywordtype">implicit none</span></div><div class="line"><span class="keywordtype">    real</span>(dp) :: y</div><div class="line"><span class="keywordtype">    real</span>(dp), <span class="keywordtype">intent(IN)</span> :: x</div><div class="line">    y = sqrt(x) * log(x)</div><div class="line"><span class="keyword">  end function </span>fquad451</div><div class="line"></div><div class="line"><span class="keyword">end program </span>ex_iads</div><div class="line"></div></div><!-- fragment --><p>Routine <a class="el" href="a00541.html">iadsi</a> is available for semi-infinite integration domains.</p>
<p>For instance, for the function</p>
<div class="image">
<img src="ex_integr_iadsi.png" alt="ex_integr_iadsi.png"/>
</div>
<p>we see that the main contribution comes from the region below <img class="formulaInl" alt="$x \sim 1$" src="form_5.png"/>. Then, we can use that information as argument <code>brkpts</code>, as shown in the following example</p>
<div class="fragment"><div class="line"><span class="keyword">program</span> ex_iadsi</div><div class="line">  <span class="keywordtype">USE </span>numfor, <span class="keywordtype">only</span>: dp, zero, m_pi, str, iadsi, nf_inf, qags</div><div class="line">  <span class="keywordtype">implicit none</span></div><div class="line"></div><div class="line"><span class="keywordtype">  real</span>(dp) :: err</div><div class="line">  <span class="keywordtype">integer</span> :: N</div><div class="line"></div><div class="line"><span class="keywordtype">  real</span>(dp) :: Integ1</div><div class="line">  <span class="keywordtype">intrinsic</span> dsin</div><div class="line"></div><div class="line">  <span class="keyword">call </span>iadsi(f, zero, [1._dp], integ1, epsrel=1.e-7_dp, abserr=err, neval=n)</div><div class="line">  print <span class="stringliteral">&quot;(A)&quot;</span>, <span class="stringliteral">&#39;integrate(log(1+x)/(1 + 100*x^2), 0, inf) = &#39;</span>//str(integ1)//<span class="stringliteral">&quot; (Error=&quot;</span>//str(err)//<span class="stringliteral">&quot;) with N = &quot;</span>//str(abs(n))</div><div class="line">  <span class="comment">! integrate(log(1+x)/(1 + 100*x^2), 0, inf) = 0.0335216255386 (Error=1.259162853146e-12) with N = 165</span></div><div class="line"><span class="keyword">contains</span></div><div class="line"></div><div class="line">  <span class="keyword">function </span>f(x) <span class="keyword">result</span>(y)</div><div class="line">    <span class="keywordtype">implicit none</span></div><div class="line"><span class="keywordtype">    real</span>(dp) :: y</div><div class="line"><span class="keywordtype">    real</span>(dp), <span class="keywordtype">intent(IN)</span> :: x</div><div class="line">    y = log(1 + x) / (1 + 100 * x**2)</div><div class="line"><span class="keyword">  end function </span>f</div><div class="line"></div><div class="line"><span class="keyword">end program </span>ex_iadsi</div><div class="line"></div></div><!-- fragment --><h2><a class="anchor" id="descthsh"></a>Integration using the Tanh-sinh scheme</h2>
<p>Routine <a class="el" href="a00557.html">qnthsh</a> is an implementation of the Tanh-sinh quadrature method. As explained in <a href="https://en.wikipedia.org/wiki/Tanh-sinh_quadrature">Wikipedia</a>, the <em>tanh-sinh</em> or <em>Double exponential</em> quadrature is a method for numerical integration introduced by <a href="https://doi.org/10.2977%2Fprims%2F1195192451">Hidetosi Takahasi and Masatake Mori in 1974</a>. It is based in the change of variables</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ x := g(t) = \tanh\left(\frac{\pi}{2}\sinh t\right)\,\]" src="form_6.png"/>
</p>
<p>to transform an integral on the interval x ∈ (−1, +1) to an integral on the entire real line t ∈ (−∞, +∞). After this transformation, the integrand decays with a double exponential rate, and thus, this method is also known as the "Double Exponential (DE) formula" (<a href="https://doi.org/10.2977/prims/1145474600">Mori, Masatake (2005), "Discovery of the Double Exponential Transformation and Its Developments", Publications of the Research Institute for Mathematical Sciences, 41 (4): 897-935</a>).</p>
<p>For a given step size h, the integral is approximated by the sum </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \int_{-1}^{1} f(x) \, dx \approx \sum_{k=-\infty}^\infty w_{k} f(x_{k}),\]" src="form_7.png"/>
</p>
<p>with the abscissas </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ x_k := g(h k) = \tanh\left(\frac{\pi}{2}\sinh kh\right) \]" src="form_8.png"/>
</p>
<p>and the weights </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[w_k := g'( h k) = \frac{\frac{\pi}{2}h \cosh(kh)}{\cosh^{2} \big(\frac{\pi}{2} \sinh (kh) \big)}.\]" src="form_9.png"/>
</p>
<p>The Tanh-Sinh method is quite insensitive to endpoint behavior. Should singularities or infinite derivatives exist at one or both endpoints of the (−1, +1) interval, these are mapped to the (−∞,+∞) endpoints of the transformed interval, forcing the endpoint singularities and infinite derivatives to vanish. This results in a great enhancement of the accuracy of the numerical integration procedure, which is typically performed by the Trapezoidal Rule. In most cases, the transformed integrand displays a rapid roll-off (decay), enabling the numerical integrator to quickly achieve convergence.</p>
<h3>Examples of use</h3>
<p>The most simple example of using the routine is given by</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="keyword">program</span> ex_qthsh1</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  <span class="keywordtype">USE </span>numfor, <span class="keywordtype">only</span>: dp, zero, m_pi, str, center, qnthsh</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="keywordtype">  real</span>(dp) :: err</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;  <span class="keywordtype">integer</span> :: N</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  </div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="keywordtype">  real</span>(dp) :: Integ1</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;  <span class="keywordtype">intrinsic</span> dsin</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;  print <span class="stringliteral">&quot;(A)&quot;</span>, center(<span class="stringliteral">&quot; Integrate sin(x) between 0 and pi &quot;</span>, 70, <span class="stringliteral">&#39;-&#39;</span>)</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;  <span class="keyword">call </span>qnthsh(dsin, zero, m_pi, integ1)</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;  print <span class="stringliteral">&quot;(A)&quot;</span>, <span class="stringliteral">&#39;\int \sin(x) dx = &#39;</span>//str(integ1)//<span class="stringliteral">&quot; (Difference=&quot;</span>//str(abs(2 - integ1))//<span class="stringliteral">&quot;)&quot;</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;  <span class="comment">! that prints:</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;  <span class="comment">!------------------ Integrate sin(x) between 0 and pi -----------------</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;  <span class="comment">! \int \sin(x) dx = 2 (Difference=0)</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;  </div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;  print <span class="stringliteral">&quot;(A)&quot;</span>, center(<span class="stringliteral">&quot; Get estimation of error and number of evaluations &quot;</span>, 70, <span class="stringliteral">&#39;-&#39;</span>)</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;  <span class="keyword">call </span>qnthsh(dsin, zero, m_pi, integ1, abserr=err, neval=n)</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;  print <span class="stringliteral">&quot;(A)&quot;</span>, <span class="stringliteral">&#39;\int \sin(x) dx = &#39;</span>//str(integ1)//<span class="stringliteral">&quot; (Error=&quot;</span>//str(err)//<span class="stringliteral">&quot;) with N = &quot;</span>//str(n)</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;  <span class="comment">! that prints:</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;  <span class="comment">!---------- Get estimation of error and number of evaluations ---------</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;  <span class="comment">! \int \sin(x) dx = 2 (Error=4.8361314952672e-12) with N = 65</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="keyword">end program </span>ex_qthsh1</div></div><!-- fragment --><p>Here in the call in line 10 is the simplest possible and only uses the required arguments.</p>
<h2><a class="anchor" id="descquadpack"></a>Quadpack routines</h2>
<p>The code implemented here has been slightly adapted from the original <b><a href="http://www.netlib.org/quadpack/">Quadpack</a></b> routines (by Piessens, de Doncker-Kapenga, Ueberhuber and Kahaner). It has been ported to Modern Fortran by following several sources: <a href="https://www.gnu.org/software/gsl/">Gnu Scientific Library</a>, <a href="https://people.sc.fsu.edu/~jburkardt/f_src/quadpack_double/quadpack_double.html">J. Burkardt's page</a>, and <a href="https://github.com/aamaricci/SciFortran">SciFortran</a>. Moreover, the routines have been tweaked to work with both real and complex functions.</p>
<p>There are routines for adaptive and non-adaptive integration of general functions, with specific routines for some particular difficult cases. These include integration over infinite and semi-infinite ranges, singular integrals, including potential and logarithmic singularities, computation of Cauchy principal values and oscillatory integrals.</p>
<p>The algorithms in <em>Quadpack</em> use a naming convention based on the following letters:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Symbol  </th><th class="markdownTableHeadNone">Explanation   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Q  </td><td class="markdownTableBodyNone">quadrature routine   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">N  </td><td class="markdownTableBodyNone">non-adaptive integrator   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">A  </td><td class="markdownTableBodyNone">adaptive integrator   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">G  </td><td class="markdownTableBodyNone">general integrand (user-defined)   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">W  </td><td class="markdownTableBodyNone">weight function with integrand   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">S  </td><td class="markdownTableBodyNone">singularities can be more readily integrated   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">P  </td><td class="markdownTableBodyNone">points of special difficulty can be supplied   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">I  </td><td class="markdownTableBodyNone">infinite range of integration   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">O  </td><td class="markdownTableBodyNone">oscillatory weight function, cos or sin   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">F  </td><td class="markdownTableBodyNone">Fourier integral   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">C  </td><td class="markdownTableBodyNone">Cauchy principal value   </td></tr>
</table>
<p>The algorithms are built on pairs of quadrature rules, a higher order rule and a lower order rule. The higher order rule is used to compute the best approximation to an integral over a small range. The difference between the results of the higher order rule and the lower order rule gives an estimate of the error in the approximation.</p>
<p>All subroutines present a similar interface. They accept several optional input and output arguments but, in their simpler form, all integrators without weight functions may be called as</p>
<div class="fragment"><div class="line"><span class="comment">call integrator(f, a, b, IntVal)</span></div></div><!-- fragment --><p> where <code>f</code> is a real or complex function <code>f(x,[args])</code> as described in <a class="el" href="a00952.html#integwhichfunction">Integrable functions</a>, <code>IntVal</code> is the value returned with an approximation to the integral of <code>f</code> over the (possibly infinite) interval <code>(a,b)</code>.</p>
<p>There are available the following integration routines:</p>
<h3>Subroutine QNG for non-adaptive integration</h3>
<p>The <a class="el" href="a00561.html">subroutine qng</a> is a simple non-adaptive automatic integrator, based on a sequence of rules with increasing degree of algebraic precision (Patterson, 1968). It applies the Gauss-Kronrod 10-point, 21-point, 43-point and 87-point integration rules in succession until an estimate of the integral is achieved within the desired absolute and relative error limits. Each successive approximation reuses the previous function evaluations.</p>
<h4>Examples of use</h4>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="keyword">program</span> ex_qng</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  <span class="keywordtype">USE </span>numfor, <span class="keywordtype">only</span>: dp, zero, m_pi, str, center, qng</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  <span class="keywordtype">implicit none</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="keywordtype">  real</span>(dp) :: err</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  <span class="keywordtype">integer</span> :: N</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="keywordtype">  real</span>(dp) :: w</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;  </div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="keywordtype">  real</span>(dp) :: Integ1</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;  <span class="keywordtype">complex(dp)</span> :: Integ2</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;  <span class="keywordtype">intrinsic</span> dsin</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;  print <span class="stringliteral">&quot;(A)&quot;</span>, center(<span class="stringliteral">&quot; Integrate sin(x) between 0 and pi &quot;</span>, 70, <span class="stringliteral">&#39;-&#39;</span>)</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;  <span class="keyword">call </span>qng(dsin, zero, m_pi, integ1)</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;  print <span class="stringliteral">&quot;(A)&quot;</span>, <span class="stringliteral">&#39;\int \sin(x) dx = &#39;</span>//str(integ1)//<span class="stringliteral">&quot; (Difference=&quot;</span>//str(abs(2 - integ1))//<span class="stringliteral">&quot;)&quot;</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;  <span class="comment">! that prints:</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;  <span class="comment">!------------------ Integrate sin(x) between 0 and pi -----------------</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;  <span class="comment">! \int \sin(x) dx = 2 (Difference=0)</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;  </div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;  w = 100._dp</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;  print <span class="stringliteral">&quot;(A)&quot;</span>, center(<span class="stringliteral">&quot; Get estimation of error and number of evaluations &quot;</span>, 70, <span class="stringliteral">&#39;-&#39;</span>)</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;  <span class="keyword">call </span>qng(fquad451, zero, m_pi, integ1, abserr=err, neval=n)</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;  print <span class="stringliteral">&quot;(A)&quot;</span>, <span class="stringliteral">&#39;\int \sqrt(x) \log(x) dx = &#39;</span>//str(integ1)//<span class="stringliteral">&quot; (Error=&quot;</span>//str(err)//<span class="stringliteral">&quot;) with N = &quot;</span>//str(n)</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;  <span class="comment">! that prints:</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;  <span class="comment">!---------- Get estimation of error and number of evaluations ---------</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;  <span class="comment">! \int \sqrt(x) \log(x) dx = 1.774674495015 (Error=6.9889313343983e-05) with N = 87</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;  print <span class="stringliteral">&quot;(A)&quot;</span>, center(<span class="stringliteral">&quot; Integrate a complex function &quot;</span>, 70, <span class="stringliteral">&#39;-&#39;</span>)</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;  <span class="keyword">call </span>qng(fquad452wc, zero, m_pi, [w], integ2, abserr=err, neval=n)</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;  print <span class="stringliteral">&quot;(A)&quot;</span>, <span class="stringliteral">&#39;\int \cos(w \sin(x)) dx = &#39;</span>//str(integ2)//<span class="stringliteral">&quot; (Error=&quot;</span>//str(err)//<span class="stringliteral">&quot;) with N = &quot;</span>//str(n)</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;  <span class="comment">! that prints:</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  <span class="comment">!-------------------- Integrate a complex function --------------------</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  <span class="comment">! \int \cos(w \sin(x)) dx = (0.062787400402-0.2226721656122j) (Error=2.8652541230259) with N = 87</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="keyword">contains</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  <span class="keyword">function </span>fquad451(x) <span class="keyword">result</span>(y)</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <span class="keywordtype">implicit none</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="keywordtype">    real</span>(dp) :: y</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="keywordtype">    real</span>(dp), <span class="keywordtype">intent(IN)</span> :: x</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    y = sqrt(x) * log(x)</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="keyword">  end function </span>fquad451</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  <span class="keyword">function </span>fquad452wc(x, w) <span class="keyword">result</span>(y)</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <span class="keywordtype">implicit none</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <span class="keywordtype">complex(dp)</span> :: y</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="keywordtype">    real</span>(dp), <span class="keywordtype">intent(IN)</span> :: x</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="keywordtype">    real</span>(dp), <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">intent(IN)</span> :: w</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    y = cmplx(cos(w(1) * sin(x)), sin(w(1) * sin(x)), kind=dp)</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="keyword">  end function </span>fquad452wc</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="keyword">end program </span>ex_qng</div></div><!-- fragment --><h3>Subroutine QAG for simple adaptive integration</h3>
<p>The subroutine <a class="el" href="a00565.html">qag</a> uses a global adaptive scheme in which the interval is divided and at each step the integral is calculated for each subinterval, and the one with the larger error is bisected. This scheme is recusively applied and the most difficult points are calculated in finer grids.</p>
<h4>Examples of use</h4>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="keyword">program</span> ex_qag</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  <span class="keywordtype">USE </span>numfor, <span class="keywordtype">only</span>: dp, zero, m_pi, str, center, qag</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  <span class="keywordtype">implicit none</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="keywordtype">  real</span>(dp) :: err</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  <span class="keywordtype">integer</span> :: N</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="keywordtype">  real</span>(dp) :: w</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;  </div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="keywordtype">  real</span>(dp) :: Integ1</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;  <span class="keywordtype">complex(dp)</span> :: Integ2</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="keywordtype">  real</span>(dp), <span class="keywordtype">parameter</span> :: epsrel = 1.e-3_8</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;  <span class="keywordtype">intrinsic</span> dsin</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;  print <span class="stringliteral">&quot;(A)&quot;</span>, center(<span class="stringliteral">&quot; Integrate sin(x) between 0 and pi &quot;</span>, 70, <span class="stringliteral">&#39;-&#39;</span>)</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;  <span class="keyword">call </span>qag(dsin, zero, m_pi, integ1)</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;  print <span class="stringliteral">&quot;(A)&quot;</span>, <span class="stringliteral">&#39;\int \sin(x) dx = &#39;</span>//str(integ1)//<span class="stringliteral">&quot; (Difference=&quot;</span>//str(abs(2 - integ1))//<span class="stringliteral">&quot;)&quot;</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;  <span class="comment">! that prints:</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;  <span class="comment">!------------------ Integrate sin(x) between 0 and pi -----------------</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;  <span class="comment">! \int \sin(x) dx = 2 (Difference=0)</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;  </div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;  w = 100._dp</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;  print <span class="stringliteral">&quot;(A)&quot;</span>, center(<span class="stringliteral">&quot; Get estimation of error and number of evaluations &quot;</span>, 70, <span class="stringliteral">&#39;-&#39;</span>)</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;  <span class="keyword">call </span>qag(fquad451, zero, m_pi, integ1, abserr=err, neval=n)</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;  print <span class="stringliteral">&quot;(A)&quot;</span>, <span class="stringliteral">&#39;\int \sqrt(x) \log(x) dx = &#39;</span>//str(integ1)//<span class="stringliteral">&quot; (Error=&quot;</span>//str(err)//<span class="stringliteral">&quot;) with N = &quot;</span>//str(n)</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;  <span class="keyword">call </span>qag(fquad451, zero, m_pi, integ1, rule=<span class="stringliteral">&#39;qk21&#39;</span>, abserr=err, neval=n)</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;  print <span class="stringliteral">&quot;(A)&quot;</span>, <span class="stringliteral">&#39;\int \sqrt(x) \log(x) dx = &#39;</span>//str(integ1)//<span class="stringliteral">&quot; (Error=&quot;</span>//str(err)//<span class="stringliteral">&quot;) with N = &quot;</span>//str(n)</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;  <span class="comment">! ---------- Get estimation of error and number of evaluations ---------</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;  <span class="comment">! \int \sqrt(x) \log(x) dx = 1.7746752010439 (Error=7.9254688067762e-06) with N = 375</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  <span class="comment">! \int \sqrt(x) \log(x) dx = 1.7746751858103 (Error=1.4425452046185e-05) with N = 441</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  print <span class="stringliteral">&quot;(A)&quot;</span>, center(<span class="stringliteral">&quot; Integrate a complex function &quot;</span>, 70, <span class="stringliteral">&#39;-&#39;</span>)</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  <span class="keyword">call </span>qag(fquad452wc, zero, m_pi, [w], integ2, rule=<span class="stringliteral">&#39;qk61&#39;</span>, abserr=err, neval=n)</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  print <span class="stringliteral">&quot;(A)&quot;</span>, <span class="stringliteral">&#39;\int \cos(w \sin(x)) dx = &#39;</span>//str(integ2)//<span class="stringliteral">&quot; (Error=&quot;</span>//str(err)//<span class="stringliteral">&quot;) with N = &quot;</span>//str(n)</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  <span class="comment">! that prints:</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  <span class="comment">!-------------------- Integrate a complex function --------------------</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  <span class="comment">! \int \cos(w \sin(x)) dx = (0.062787390876-0.2226721893626j) (Error=1.7375840100087e-08) with N = 427</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="keyword">contains</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  <span class="keyword">function </span>fquad451(x) <span class="keyword">result</span>(y)</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <span class="keywordtype">implicit none</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="keywordtype">    real</span>(dp) :: y</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="keywordtype">    real</span>(dp), <span class="keywordtype">intent(IN)</span> :: x</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    y = sqrt(x) * log(x)</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="keyword">  end function </span>fquad451</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  <span class="keyword">function </span>fquad452wc(x, w) <span class="keyword">result</span>(y)</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <span class="keywordtype">implicit none</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="keywordtype">complex(dp)</span> :: y</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="keywordtype">    real</span>(dp), <span class="keywordtype">intent(IN)</span> :: x</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="keywordtype">    real</span>(dp), <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">intent(IN)</span> :: w</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    y = cmplx(cos(w(1) * sin(x)), sin(w(1) * sin(x)), kind=dp)</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="keyword">  end function </span>fquad452wc</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="keyword">end program </span>ex_qag</div></div><!-- fragment --><h3>Subroutine QAGS for general integration with singularities</h3>
<p>Subroutine <a class="el" href="a00569.html">qags</a> is a global adaptive algorithm with bisection of the integration interval and a Wynn-epsilon algorithm to extrapolate and speed-up the convergence of the integral. This routine is able to integrate functions with singularities of many types.</p>
<p>The limits of integration may be finite or infinite. By default it uses a Gauss-Kronrod rule of 21 points for finite limits, and a 15-points rule for infinite limits. The rule may be given to the routine as an argument.</p>
<p>The integration over the infinite intervals are is performed by means of mappings to the semi-open interval <img class="formulaInl" alt="$(0,1]$" src="form_10.png"/>.</p>
<h4>Examples of use</h4>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="keyword">program</span> ex_qags</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  <span class="keywordtype">USE </span>numfor, <span class="keywordtype">only</span>: dp, zero, m_pi, nf_inf, nf_minf, str, center, qags</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  <span class="keywordtype">implicit none</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="keywordtype">  real</span>(dp) :: err</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  <span class="keywordtype">integer</span> :: N</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="keywordtype">  real</span>(dp) :: w</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;  </div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="keywordtype">  real</span>(dp) :: Integ1</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;  <span class="keywordtype">intrinsic</span> dsin</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;  print <span class="stringliteral">&quot;(A)&quot;</span>, center(<span class="stringliteral">&quot; Integrate sin(x) between 0 and pi &quot;</span>, 70, <span class="stringliteral">&#39;-&#39;</span>)</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;  <span class="keyword">call </span>qags(dsin, zero, m_pi, integ1)</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;  print <span class="stringliteral">&quot;(A)&quot;</span>, <span class="stringliteral">&#39;integrate(sin(x), 0, pi) = &#39;</span>//str(integ1)//<span class="stringliteral">&quot; (Difference=&quot;</span>//str(abs(2 - integ1))//<span class="stringliteral">&quot;)&quot;</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;  <span class="comment">! that prints:</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;  <span class="comment">!------------------ Integrate sin(x) between 0 and pi -----------------</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;  <span class="comment">! integrate(sin(x), 0, pi) = 1.9999999827467 (Difference=1.725330678326e-08)</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;  </div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;  w = 100._dp</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;  <span class="comment">!  Get estimation of error and number of evaluations</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;  <span class="keyword">call </span>qags(fquad453, zero, 1._dp, integ1, gkrule=<span class="stringliteral">&#39;qk15&#39;</span>, abserr=err, neval=n)</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;  print <span class="stringliteral">&quot;(A)&quot;</span>, <span class="stringliteral">&#39;integrate( \log(x)/\sqrt(x), 0, 1) = &#39;</span>//str(integ1)//<span class="stringliteral">&quot; (Error=&quot;</span>//str(err)//<span class="stringliteral">&quot;) with N = &quot;</span>//str(n)</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;  <span class="comment">! integrate( \log(x)/\sqrt(x), 0, 1) = -3.9999999999999 (Error=5.1247894816697e-13) with N = 225</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;  <span class="keyword">call </span>qags(fquad455w, zero, nf_inf, [w], integ1, gkrule=<span class="stringliteral">&#39;qk21&#39;</span>, abserr=err, neval=n)</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;  print <span class="stringliteral">&quot;(A)&quot;</span>, <span class="stringliteral">&#39;integrate( \log(x)/(1 + w x^2), 0, +∞) = &#39;</span>//str(integ1)//<span class="stringliteral">&quot; (Error=&quot;</span>//str(err)//<span class="stringliteral">&quot;) with N = &quot;</span>//str(n)</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;  <span class="comment">! integrate( \log(x)/(1 + w x^2), 0, +∞) = -0.3616892188416 (Error=2.170181735946e-07) with N = 399</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="keyword">contains</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  <span class="keyword">function </span>fquad453(x) <span class="keyword">result</span>(y)</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    <span class="keywordtype">implicit none</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="keywordtype">    real</span>(dp) :: y</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="keywordtype">    real</span>(dp), <span class="keywordtype">intent(IN)</span> :: x</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    y = log(x) / sqrt(x)</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="keyword">  end function </span>fquad453</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  <span class="keyword">function </span>fquad455w(x, w) <span class="keyword">result</span>(y)</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <span class="keywordtype">implicit none</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="keywordtype">    real</span>(dp) :: y</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="keywordtype">    real</span>(dp), <span class="keywordtype">intent(IN)</span> :: x</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="keywordtype">    real</span>(dp), <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">intent(IN)</span> :: w</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    y = log(x) / (1 + w(1) * x**2)</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="keyword">  end function </span>fquad455w</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="keyword">end program </span>ex_qags</div></div><!-- fragment --><h3>Subroutine QAGP integration with known singular points</h3>
<p>Subroutine <a class="el" href="a00573.html">qagp</a> uses the same strategy than <a class="el" href="a00569.html">qags</a> to integrate a function that presents singularities in the interior of the integration domain. The user has to supply an array with the points where difficulties arise.</p>
<h4>Examples of use</h4>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="keyword">program</span> ex_qagp</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  <span class="keywordtype">USE </span>numfor, <span class="keywordtype">only</span>: dp, zero, str, qagp</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  <span class="keywordtype">implicit none</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="keywordtype">  real</span>(dp) :: err</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  <span class="keywordtype">integer</span> :: N</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="keywordtype">  real</span>(dp), <span class="keywordtype">parameter</span> :: epsabs = 0.0_8</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="keywordtype">  real</span>(dp), <span class="keywordtype">parameter</span> :: epsrel = 1.e-3_8</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;  </div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="keywordtype">  real</span>(dp), <span class="keywordtype">dimension(2)</span> :: points</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="keywordtype">  real</span>(dp) :: Integ1</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;  points(:2) = [1._8, sqrt(2._8)]</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;  <span class="keyword">call </span>qagp(fquad454, zero, 3._dp, points, integ1, epsabs, epsrel, err, neval=n)</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;  print <span class="stringliteral">&quot;(A)&quot;</span>, <span class="stringliteral">&#39;integrate(x^3 \log{|(x^2-1)(x^2-2)|}, x, 0, 3) = &#39;</span>//str(integ1)//<span class="stringliteral">&quot; (Error=&quot;</span>//str(err)//<span class="stringliteral">&quot;) with N = &quot;</span>//str(n)</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;  <span class="comment">! integrate(x^3 \log{|(x^2-1)(x^2-2)|}, x, 0, 3) = 52.7408058906746 (Error=0.0001754605945) with N = 777</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="keyword">contains</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;  <span class="keyword">function </span>fquad454(x) <span class="keyword">result</span>(y)</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    <span class="keywordtype">implicit none</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="keywordtype">    real</span>(dp) :: y</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="keywordtype">    real</span>(dp), <span class="keywordtype">intent(IN)</span> :: x</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    y = x**3 * log(abs((x**2 - 1._dp) * (x**2 - 2._dp)))</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="keyword">  end function </span>fquad454</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="keyword">end program </span>ex_qagp</div></div><!-- fragment --><h3>Subroutine QAWO for Oscillatory functions</h3>
<p>Subroutine <a class="el" href="a00581.html">qawo</a> computes the integral of a function <code>f</code> multiplied by a oscillatory function of <img class="formulaInl" alt="$\cos{(\omega x)}$" src="form_11.png"/> (for <code>flgw</code>=1) or <img class="formulaInl" alt="$\sin{(\omega x)}$" src="form_12.png"/> (for <code>flgw</code>=1),</p>
<h4>Examples of use</h4>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="keyword">program</span> ex_qawo</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  <span class="keywordtype">USE </span>numfor, <span class="keywordtype">only</span>: dp, zero, m_pi, str, qawo</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  <span class="keywordtype">implicit none</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="keywordtype">  real</span>(dp) :: err</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;  <span class="keywordtype">integer</span> :: N</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  </div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="keywordtype">  real</span>(dp) :: Integ1</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;  <span class="comment">! Fifth argument, flgw=1 =&gt; weight function is cosine</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;  <span class="comment">! fquad456 =&gt; log(x)</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;  <span class="keyword">call </span>qawo(fquad456, zero, 1._dp, 10 * m_pi, 2, integ1)</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;  print <span class="stringliteral">&quot;(A)&quot;</span>, <span class="stringliteral">&#39;integrate(sin(10 pi x) log(x), x, 0, 1) = &#39;</span>//str(integ1)</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;  <span class="comment">! integrate(sin(10 pi x) log(x), x, 0, 1) = -0.1281368491001</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;  </div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;  <span class="keyword">call </span>qawo(fquad456, zero, 1._dp, 10 * m_pi, 1, integ1, epsabs=zero, epsrel=1.e-3_dp, abserr=err, neval=n)</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;  print <span class="stringliteral">&quot;(A)&quot;</span>, <span class="stringliteral">&#39;integrate(cos(10 pi x) log(x), x, 0, 1) = &#39;</span>//str(integ1)//<span class="stringliteral">&quot; (Error=&quot;</span>//str(err)//<span class="stringliteral">&quot;) with N = &quot;</span>//str(n)</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;  <span class="comment">! integrate(cos(10 pi x) log(x), x, 0, 1) = -0.0489888171135 (Error=4.8212107917056e-10) with N = 305</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="keyword">contains</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;  <span class="keyword">function </span>fquad456(x) <span class="keyword">result</span>(y)</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    <span class="keywordtype">implicit none</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="keywordtype">    real</span>(dp) :: y</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="keywordtype">    real</span>(dp), <span class="keywordtype">intent(IN)</span> :: x</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    y = zero</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    <span class="keywordflow">IF</span> (x &gt; 0) y = log(x)</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="keyword">  end function </span>fquad456</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="keyword">end program </span>ex_qawo</div></div><!-- fragment --><h3>Subroutine QAWF for Fourier Transforms</h3>
<p>Subroutine <a class="el" href="a00585.html">qawf</a> computes the (possibly semi-infinite) cosine (for <code>flgw</code>=1) or sine (for <code>flgw</code>=2) Fourier transform of <code>f</code> using an adaptive algorithm</p>
<h4>Examples of use</h4>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="keyword">program</span> ex_qawf</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  <span class="keywordtype">USE </span>numfor, <span class="keywordtype">only</span>: dp, zero, m_pi, str, qawf</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  <span class="keywordtype">implicit none</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="keywordtype">  real</span>(dp) :: err</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;  <span class="keywordtype">integer</span> :: N, ier</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  </div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="keywordtype">  real</span>(dp) :: Integ1</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;  <span class="comment">! Fourth argument, flgw=1 =&gt; weight function is cosine</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;  <span class="comment">! fquad457 =&gt; 1/\sqrt(x)</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;  <span class="keyword">call </span>qawf(fquad457, zero, m_pi / 2, 1, integ1)</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;  print <span class="stringliteral">&quot;(A)&quot;</span>, <span class="stringliteral">&#39;integrate(cos(pi x /2 ) / sqrt(x), x, 0, inf ) = &#39;</span>//str(integ1)</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;  <span class="comment">! integrate(cos(pi x /2 ) / sqrt(x), x, 0, inf ) = 0.9999999999321</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;  </div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;  <span class="keyword">call </span>qawf(fquad457, zero, m_pi / 2, 1, integ1, epsabs=1.e-3_dp, abserr=err, neval=n, ier=ier)</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;  print <span class="stringliteral">&quot;(A)&quot;</span>, <span class="stringliteral">&#39;integrate(cos(pi x /2 ) / sqrt(x), x, 0, inf ) = &#39;</span>//str(integ1)//<span class="stringliteral">&quot; (Error=&quot;</span>//str(err)//<span class="stringliteral">&quot;) with N = &quot;</span>//str(n)</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;  <span class="comment">! integrate(cos(pi x /2 ) / sqrt(x), x, 0, inf ) = 0.9999969531148 (Error=0.0005923419178) with N = 380</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="keyword">contains</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;  <span class="keyword">function </span>fquad457(x) <span class="keyword">result</span>(y)</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;    <span class="keywordtype">implicit none</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="keywordtype">    real</span>(dp) :: y</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="keywordtype">    real</span>(dp), <span class="keywordtype">intent(IN)</span> :: x</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    y = 0._8</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    <span class="keywordflow">IF</span> (x &gt; 0) y = 1.0_8 / sqrt(x)</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="keyword">  end function </span>fquad457</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="keyword">end program </span>ex_qawf</div></div><!-- fragment --><h3>Subroutine QAWS for integration of singular functions</h3>
<p>Subroutine <a class="el" href="a00589.html">qaws</a> computes the integral of a function <code>f</code> multiplied by a weight function with an algebraic-logarithmic singularity chosen according to the flag <code>flgw</code>,</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"><code>flgw</code>  </th><th class="markdownTableHeadNone">Weight function   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">1  </td><td class="markdownTableBodyNone"><img class="formulaInl" alt="$(x - a)^\alpha (b - x)^\beta$" src="form_13.png"/>   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">2  </td><td class="markdownTableBodyNone"><img class="formulaInl" alt="$(x - a)^\alpha (b - x)^\beta \log{(x-a)}$" src="form_14.png"/>   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">3  </td><td class="markdownTableBodyNone"><img class="formulaInl" alt="$(x - a)^\alpha (b - x)^\beta \log{(b-x)}$" src="form_15.png"/>   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">4  </td><td class="markdownTableBodyNone"><img class="formulaInl" alt="$(x - a)^\alpha (b - x)^\beta \log{(x-a)} \log{(b-x)}$" src="form_16.png"/>   </td></tr>
</table>
<p>The points <img class="formulaInl" alt="$(a,b)$" src="form_17.png"/> are the limits of the integration domain.</p>
<h4>Examples of use</h4>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="keyword">program</span> ex_qaws</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  <span class="keywordtype">USE </span>numfor, <span class="keywordtype">only</span>: dp, zero, str, qaws</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  <span class="keywordtype">implicit none</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="keywordtype">  real</span>(dp) :: err</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  <span class="keywordtype">integer</span> :: N</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;  </div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="keywordtype">  real</span>(dp) :: Integ1</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="keywordtype">  real</span>(dp) :: alfa, beta</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;  <span class="keywordtype">integer</span> :: flgw</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;  alfa = 0._dp</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;  beta = 0._dp</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;  flgw = 2                 <span class="comment">! weight function =&gt; log(x-a)^alfa = log(x)</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;  <span class="comment">! fquad458 = 1/(1 + \ln(x)^{2})^{2}</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;  <span class="keyword">call </span>qaws(fquad458, zero, 1._dp, alfa, beta, flgw, integ1)</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;  print <span class="stringliteral">&quot;(A)&quot;</span>, <span class="stringliteral">&#39;integrate(log(x)/(1 + ln(x)^{2})^{2}, 0, 1) = &#39;</span>//str(integ1)</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;  <span class="comment">! integrate(log(x)/(1 + ln(x)^{2})^{2}, 0, 1) = -0.1892750041577</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;  </div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;  <span class="comment">!  Get estimation of error and number of evaluations</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;  <span class="keyword">call </span>qaws(fquad458, zero, 1._dp, alfa, beta, flgw, integ1, epsrel=1.e-3_dp, abserr=err, neval=n)</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;  print <span class="stringliteral">&quot;(A)&quot;</span>, <span class="stringliteral">&#39;integrate(log(x)/(1 + ln(x)^{2})^{2}, 0, 1) = &#39;</span>//str(integ1)//<span class="stringliteral">&quot; (Error=&quot;</span>//str(err)//<span class="stringliteral">&quot;) with N = &quot;</span>//str(n)</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;  <span class="comment">! integrate(log(x)/(1 + ln(x)^{2})^{2}, 0, 1) = -0.1892747444915 (Error=2.2226716553438e-06) with N = 40</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="keyword">contains</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;  <span class="keyword">function </span>fquad458(x) <span class="keyword">result</span>(y)</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    <span class="keywordtype">implicit none</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="keywordtype">    real</span>(dp) :: y</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="keywordtype">    real</span>(dp), <span class="keywordtype">intent(IN)</span> :: x</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    y = 1 / (1 + log(x)**2)**2</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="keyword">  end function </span>fquad458</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="keyword">end program </span>ex_qaws</div></div><!-- fragment --><h3>Subroutine QAWC for Cauchy principal values</h3>
<p>Subroutine <a class="el" href="a00593.html">qawc</a> computes Cauchy Principal Value of the integral of <code>f</code> using the bisection strategy of <a class="el" href="a00565.html">qag</a></p>
<h4>Examples of use</h4>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="keyword">program</span> ex_qaws</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  <span class="keywordtype">USE </span>numfor, <span class="keywordtype">only</span>: dp, str, qawc, nf_minf</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  <span class="keywordtype">implicit none</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="keywordtype">  real</span>(dp) :: err</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;  <span class="keywordtype">integer</span> :: N, ier</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  </div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="keywordtype">  real</span>(dp) :: Integ1</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;  <span class="keyword">call </span>qawc(fquad459, -1._dp, 5._dp, 0._dp, integ1)</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;  print <span class="stringliteral">&quot;(A)&quot;</span>, <span class="stringliteral">&#39;integrate(1/(x(5 x^3 + 6), -1, 5))  = &#39;</span>//str(integ1)</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;  <span class="comment">! integrate(1/(x(5 x^3 + 6), -1, 5))  = -0.0899440069576</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;  </div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;  <span class="keyword">call </span>qawc(fquad459, -1._dp, 5._dp, 0._dp, integ1, epsrel=1.e-3_dp, abserr=err, neval=n, ier=ier)</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;  print <span class="stringliteral">&quot;(A)&quot;</span>, <span class="stringliteral">&#39;integrate(1/(x(5 x^3 + 6), -1, 5)) = &#39;</span>//str(integ1)//<span class="stringliteral">&quot; (Error=&quot;</span>//str(err)//<span class="stringliteral">&quot;) with N = &quot;</span>//str(n)</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;  <span class="comment">! integrate(1/(x(5 x^3 + 6), -1, 5)) = -0.0899440069584 (Error=1.1852922354142e-06) with N = 215</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="keyword">contains</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;  <span class="keyword">function </span>fquad459(x) <span class="keyword">result</span>(y)</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;    <span class="keywordtype">implicit none</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="keywordtype">    real</span>(dp) :: y</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="keywordtype">    real</span>(dp), <span class="keywordtype">intent(IN)</span> :: x</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    y = 1 / (5 * x**3 + 6)</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="keyword">  end function </span>fquad459</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="keyword">end program </span>ex_qaws</div></div><!-- fragment --><h3><a class="anchor" id="qp_info"></a>Use of the extra parameter <code>info</code></h3>
<p>Most adaptive routines allow for an optional input/output argument <code>info</code>. It is mainly used to pass information on details of the calculations. This argument is a variable of the type <a class="el" href="a00649.html">d_qp_extra</a> for integration of real functions, and of the type <a class="el" href="a00653.html">c_qp_extra</a> for integration of complex functions.</p>
<p>Following Piessend <em>et al</em> we illustrate one of its use considering the integral </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \int_{0}^{1} \left| x^{2} + 2 x -1 \right|^{-1/2} \, dx = \arcsin(1/\sqrt(3)) - \frac{\pi}{2} - \log(3)/2 \approx 1.504622 \]" src="form_18.png"/>
</p>
<p>In this case the integral converges</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="keyword">program</span> ex_qp_extra</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  <span class="keywordtype">USE </span>numfor, <span class="keywordtype">only</span>: dp, zero, m_pi_2, str, d_qp_extra, qag, qags</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  <span class="keywordtype">implicit none</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="keywordtype">  real</span>(dp) :: err</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  <span class="keywordtype">integer</span> :: ier, N</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;  <span class="keywordtype">integer</span> :: j, k</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;  <span class="keywordtype">type</span>(d_qp_extra) :: info</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="keywordtype">  real</span>(dp) :: Integ1</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;  <span class="comment">! Initialize allowing up to 50 subintervals</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;  <span class="comment">! This is optional, by default it will allow for 500 subintervals</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;  info = 50</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;  <span class="keyword">call </span>qags(fquad4510, zero, 1._dp, integ1, epsabs=zero, epsrel=1.e-4_dp, gkrule=<span class="stringliteral">&#39;qk15&#39;</span>, abserr=err, neval=n, ier=ier, info=info)</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;  print <span class="stringliteral">&quot;(A)&quot;</span>, <span class="stringliteral">&#39;integrate(1/sqrt(|x^2 + 2x -2|), x, 0, 1) = &#39;</span>//str(integ1)//<span class="stringliteral">&quot; (Error=&quot;</span>//str(err)//<span class="stringliteral">&quot;) with N = &quot;</span>//str(n)</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;  print <span class="stringliteral">&quot;(A)&quot;</span>, <span class="stringliteral">&quot;Difference = &quot;</span>//str(abs(integ1 - (m_pi_2 - asin(1 / sqrt(3._dp)) + log(3._dp) / 2)))//&amp;</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;    &amp; <span class="stringliteral">&quot; relative to analytical value&quot;</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;  print <span class="stringliteral">&quot;(A)&quot;</span>, <span class="stringliteral">&quot;Error code = &quot;</span>//str(ier)</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;  print <span class="stringliteral">&quot;(A)&quot;</span>, <span class="stringliteral">&quot;Meaning:&quot;</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;  print <span class="stringliteral">&quot;(A)&quot;</span>, <span class="stringliteral">&quot;-------&quot;</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;  print <span class="stringliteral">&quot;(A)&quot;</span>, info%msg</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;  print <span class="stringliteral">&quot;(A)&quot;</span>, <span class="stringliteral">&quot;&quot;</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;  print <span class="stringliteral">&quot;(A)&quot;</span>, <span class="stringliteral">&quot; j        Limits of subinterval S(j)     Integral over S(j)    Error on S(j)    Error relative &quot;</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;  <span class="keywordflow">do</span> k = 1, info%last</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    j = info%iord(k)</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    print <span class="stringliteral">&quot;(I2, 5(es18.11,1x))&quot;</span>, k, info%alist(j), info%blist(j), info%rlist(j), info%elist(j), info%elist(j) / info%rlist(j)</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="keywordflow">  end do</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="keyword">contains</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  <span class="keyword">function </span>fquad4510(x) <span class="keyword">result</span>(y)</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <span class="keywordtype">implicit none</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="keywordtype">    real</span>(dp) :: y</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="keywordtype">    real</span>(dp), <span class="keywordtype">intent(IN)</span> :: x</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    y = 1._dp / sqrt(abs(x**2 + 2 * x - 2))</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="keyword">  end function </span>fquad4510</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="keyword">end program </span>ex_qp_extra</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div></div><!-- fragment --><p>giving as result information on the algorithm progress</p>
<div class="fragment"><div class="line">integrate(1/sqrt(|x^2 + 2x -2|), x, 0, 1) = 1.5045599601491 (Error=0.0001175019052) with N = 735</div><div class="line">Difference = 6.2802309494403e-05 relative to analytical value</div><div class="line">Error code = 0</div><div class="line">Meaning:</div><div class="line">-------</div><div class="line">Routine qags:  Normal and reliable termination of the routine.  It is assumed that the requested accuracy has been achieved.</div><div class="line"></div><div class="line"> j        Limits of subinterval S(j)     Integral over S(j)    Error on S(j)    Error relative </div><div class="line"> 1 7.32050657272E-01  7.32050895691E-01  6.61788951586E-04  2.67199722355E-04  4.03753676628E-01</div><div class="line"> 2 7.50000000000E-01  8.75000000000E-01  2.59695449021E-01  2.34942884257E-05  9.04686181996E-05</div><div class="line"> 3 7.32055664062E-01  7.32116699219E-01  6.35457321524E-03  2.21241348822E-05  3.48160830520E-03</div><div class="line"> 4 7.34375000000E-01  7.50000000000E-01  9.20419410896E-02  6.43439223180E-06  6.99071766157E-05</div><div class="line"> 5 7.32050895691E-01  7.32051849365E-01  7.77806648660E-04  1.18010670163E-06  1.51722372605E-03</div><div class="line"> 6 7.32421875000E-01  7.34375000000E-01  3.10999052060E-02  3.36607750891E-07  1.08234333405E-05</div><div class="line"> 7 7.31445312500E-01  7.31933593750E-01  1.48085753181E-02  2.20888795975E-08  1.49162759570E-06</div><div class="line"> 8 0.00000000000E+00  5.00000000000E-01  4.31717842526E-01  7.65314094754E-10  1.77271824179E-09</div><div class="line"> 9 7.32051849365E-01  7.32055664062E-01  1.27128139071E-03  5.82935274600E-10  4.58541499043E-07</div><div class="line">10 6.87500000000E-01  7.18750000000E-01  1.03290479678E-01  5.00387915491E-10  4.84447276312E-09</div><div class="line">11 7.26562500000E-01  7.30468750000E-01  3.68841542687E-02  3.09541720462E-10  8.39226834936E-09</div><div class="line">12 7.32040405273E-01  7.32048034668E-01  1.67639077543E-03  4.48780642525E-11  2.67706461466E-08</div><div class="line">13 7.32177734375E-01  7.32421875000E-01  8.59296586961E-03  4.15971773602E-12  4.84084051903E-10</div><div class="line">14 7.32048034668E-01  7.32049942017E-01  7.89650429625E-04  1.86687676455E-12  2.36418128137E-09</div><div class="line">15 6.25000000000E-01  6.87500000000E-01  1.26121798856E-01  1.15514630686E-12  9.15897424031E-12</div><div class="line">16 7.30468750000E-01  7.31445312500E-01  1.63018589630E-02  9.07839605128E-13  5.56893301058E-11</div><div class="line">17 7.18750000000E-01  7.26562500000E-01  4.43801352397E-02  4.94821770138E-13  1.11496228541E-11</div><div class="line">18 5.00000000000E-01  6.25000000000E-01  1.70177840734E-01  1.29207244330E-13  7.59248347332E-13</div><div class="line">19 7.32025146484E-01  7.32040405273E-01  1.97766297002E-03  3.28124217391E-14  1.65915134361E-11</div><div class="line">20 7.32050418854E-01  7.32050657272E-01  2.53372044356E-04  1.18649893348E-14  4.68283285354E-11</div><div class="line">21 7.31994628906E-01  7.32025146484E-01  2.61075315192E-03  2.57842783013E-15  9.87618392123E-13</div><div class="line">22 8.75000000000E-01  1.00000000000E+00  1.45769659141E-01  1.76224733434E-15  1.20892601707E-14</div><div class="line">23 7.31933593750E-01  7.31994628906E-01  3.57974836972E-03  1.00512858960E-15  2.80781911405E-13</div><div class="line">24 7.32049942017E-01  7.32050418854E-01  3.29764477394E-04  3.75908490859E-16  1.13993021271E-12</div><div class="line">25 7.32116699219E-01  7.32177734375E-01  3.38357303442E-03  9.07748753959E-17  2.68281117247E-14</div></div><!-- fragment --><p>As we can see, the general integrator <code>qags</code> is able to integrate this singular function but needs several function evaluations, with an important error in the vicinity of <img class="formulaInl" alt="$\sqrt{3}-1$" src="form_19.png"/>. We can use this additional information and replace the routine <code>qags</code> by <code>qagp</code>. It only need to change line number XX to: </p><div class="fragment"><div class="line"><span class="comment">call qagp(fquad4510, Zero, 1._dp, [sqrt(3._dp) - 1], Integ1, epsabs=Zero, epsrel=1.e-4_dp, abserr=err, Neval=N, ier=ier, info=info)</span></div></div><!-- fragment --><p>obtaining a similar (and somewhat better) result with less subdivisions of the interval and function evaluations</p>
<div class="fragment"><div class="line">integrate(1/sqrt(|x^2 + 2x -2|), x, 0, 1) = 1.5046227555966 (Error=3.5719196844752e-07) with N = 462</div><div class="line">Difference = 6.8619860904562e-09 relative to analytical value</div><div class="line">Error code = 0</div><div class="line">Meaning:</div><div class="line">-------</div><div class="line">Routine qagp: Normal and reliable termination of the routine.  It is assumed that the requested accuracy has been achieved.</div><div class="line"></div><div class="line"> j        Limits of subinterval S(j)     Integral over S(j)    Error on S(j)    Error relative </div><div class="line"> 1 7.09174219832E-01  7.32050807569E-01  1.60069187812E-01  7.73744297312E-02  4.83381160290E-01</div><div class="line"> 2 7.32050807569E-01  7.40424219832E-01  9.66937903941E-02  4.68487167016E-02  4.84505949251E-01</div><div class="line"> 3 0.00000000000E+00  3.66025403784E-01  2.93171381140E-01  8.17539976481E-09  2.78860771915E-08</div><div class="line"> 4 3.66025403784E-01  5.49038105677E-01  1.98297261193E-01  5.21098430467E-09  2.62786499083E-08</div><div class="line"> 5 8.66025403784E-01  1.00000000000E+00  1.58478399902E-01  3.86710284589E-09  2.44014505969E-08</div><div class="line"> 6 5.49038105677E-01  6.40544456623E-01  1.37342006395E-01  3.52212881075E-09  2.56449494455E-08</div><div class="line"> 7 7.99038105677E-01  8.66025403784E-01  1.13597226144E-01  2.80948755739E-09  2.47320084544E-08</div><div class="line"> 8 6.40544456623E-01  6.86297632096E-01  9.61465434121E-02  2.43826866463E-09  2.53599201604E-08</div><div class="line"> 9 7.65544456623E-01  7.99038105677E-01  8.08861095193E-02  2.01475142213E-09  2.49084970721E-08</div><div class="line">10 6.86297632096E-01  7.09174219832E-01  6.76512094521E-02  1.70646046002E-09  2.52243895393E-08</div><div class="line">11 7.48797632096E-01  7.65544456623E-01  5.73966267734E-02  1.43490327440E-09  2.49997840476E-08</div><div class="line">12 7.40424219832E-01  7.48797632096E-01  4.06573774170E-02  1.01831363346E-09  2.50462203455E-08</div></div><!-- fragment --> </div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">Numeric Modern Fortran</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.15 </li>
  </ul>
</div>
</body>
</html>
